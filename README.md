# ccallgraph

## ccallgraphについて

Linuxカーネルのソースコードなどを読むときに「手元にコールグラフがあったらなぁ」と思いませんか？
実際にそのようなソフトはいくつかあるのですが，いくつか以下のような問題点があります．

* 多くの場合，コンパイルの情報を使用しているため，ビルドが通ることを前提としている
** このため，Linuxカーネルのモジュールのグラフを生成するのが難しい
* グラフを見たときに，どの関数がどのファイルにあるのかわかりにくい

これらの問題点を解決したのがccallgraphです．

## ccallgraphの利点と欠点

このソフトの利点は以下のとおりです．

* コンパイルせずに使用することができる
* どの関数がどのファイルに属しているか，グラフから簡単にわかる

また，欠点は以下のとおりになります．
実装できるけど，手間が掛かりそうなので実装していないものも入っています．

* マクロを展開していないため，マクロ内の関数呼び出しは把握できない
* 大体この場合はこうなるだろうという推測（要はヒューリスティックス）に基づいて開発しているので，抜けやゴミなどがある
* ソースコードの分かりやすさを重視しているため，メモリや処理速度はあまり気にしていない
* 日本語まわりの検証をあまりしていないので，もしかしたら日本語のコメントが入っている場合に問題があるかも
** 多少はテストしていますが，テスト漏れがありそうです

## 動作の概要

おおよその動作の概要です．現在書きかけです．

* 最初に"("の記号がある部分を全て探す．これをhintとする．
* hintの各要素について，後ろをたどっていって"{"もしくは";"を探す
** "{"の場合は，関数定義である可能性が高い
** ";"の場合は，関数呼び出しである可能性が高い
* "("の前の文字を探して行って名前を探す
** if, for, whileなどの場合には除外する
* 関数定義の場合には，以下のふるいにかける
** 関数の中に関数が入っている場合は，より外の関数のみを選択する
* 関数呼び出しの場合には，以下のふるいにかける
** 関数定義の中に入っているか（"{"から"}"までの対括弧の中に入っているか）確認する
* 出力をする

## サンプル

### Linuxのintelfbモジュールのソース

![サンプル画像](https://github.com/yasuharu/ccallgraph/blob/master/res/sample.png)

